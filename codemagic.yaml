workflows:
  flutter_build_and_distribute:
    name: Flutter Build and Distribute
    max_build_duration: 60

    # 步骤：定义构建过程中的每一个操作
    scripts:
      - name: Checkout source code
        checkout: true

      # 安装 Flutter 依赖
      - name: Install Flutter dependencies
        script: |
          flutter pub get

      # 构建 APK (Android)
      - name: Build APK (Android)
        script: |
          flutter build apk --release

      # 构建 IPA (iOS)
      - name: Build IPA (iOS)
        script: |
          flutter build ios --release

      # 安装 Firebase CLI
      - name: Install Firebase CLI
        script: |
          npm install -g firebase-tools

      # 上传 APK 到 Firebase
      - name: Upload APK to Firebase
        script: |
          firebase appdistribution:distribute build/app/outputs/flutter-apk/app-release.apk \
            --app <YOUR_FIREBASE_APP_ID> \
            --groups testers \
            --token $FIREBASE_CLI_TOKEN

    # 指定构建产物
    artifacts:
      - build/app/outputs/flutter-apk/app-release.apk
      - build/ios/ipa/Runner.ipa

# 触发器：定义构建何时触发
triggering:
   events:
      - push
      - pull_request
